<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’ ë™ë£Œë“¤ì´ ë³´ëŠ” ë‚˜ì˜ ì§„ì§œ ëª¨ìŠµ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700;800&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --white: #ffffff;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite;
            min-height: 100vh;
            padding: 1rem;
            line-height: 1.6;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.5);
            overflow: hidden;
            position: relative;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 2rem 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-60px) translateY(-60px); }
        }

        .app-title {
            font-size: 1.75rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .app-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .app-content {
            padding: 2rem 1.5rem;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: var(--gray-50);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .question-card {
            background: var(--gray-50);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--gray-200);
        }

        .question-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gray-800);
            text-align: center;
            margin-bottom: 1.5rem;
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            gap: 0.75rem;
        }

        .option-card {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .option-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            transform: scale(1.02);
        }

        .option-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .option-emoji {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .option-text {
            font-weight: 500;
            line-height: 1.3;
        }

        .survey-intro {
            text-align: center;
            margin-bottom: 2rem;
        }

        .target-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .survey-description {
            color: var(--gray-600);
            line-height: 1.6;
        }

        .loading-screen {
            text-align: center;
            padding: 2rem;
            display: none;
        }

        .loading-dots {
            color: var(--primary);
            font-size: 1.1rem;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .result-card {
            background: var(--gray-50);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--gray-200);
        }

        .result-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }

        .result-description {
            color: var(--gray-600);
            line-height: 1.6;
        }

        .trait-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .trait-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--white);
            padding: 1rem;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .trait-info {
            flex: 1;
        }

        .trait-name {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .trait-desc {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .trait-percentage {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
            margin-left: 1rem;
        }

        .encouragement-card {
            background: linear-gradient(135deg, #fff8f0, #fef7ff);
            border: 1px solid #fde5ff;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            color: #8b5a3c;
            line-height: 1.6;
        }

        .share-section {
            margin-top: 2rem;
        }

        .share-description {
            text-align: center;
            color: var(--gray-600);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .share-link {
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            word-break: break-all;
            color: var(--primary);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: all;
        }

        .share-link:hover {
            border-color: var(--primary);
            background: var(--white);
        }

        .share-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .share-btn {
            padding: 0.875rem 1rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .share-btn.kakao {
            background: #fee500;
            color: #3c1e1e;
        }

        .share-btn.copy {
            background: var(--primary);
            color: var(--white);
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .floating-emojis {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-emoji {
            position: absolute;
            font-size: 2rem;
            opacity: 0.3;
            animation: floatAround 12s ease-in-out infinite;
        }

        @keyframes floatAround {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg);
                opacity: 0.3;
            }
            50% { 
                transform: translateY(-30px) rotate(15deg);
                opacity: 0.6;
            }
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 640px) {
            .app-container {
                margin: 0.5rem;
                border-radius: 16px;
            }

            .app-header {
                padding: 1.5rem 1rem;
            }

            .app-content {
                padding: 1.5rem 1rem;
            }

            .app-title {
                font-size: 1.5rem;
            }

            .result-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .share-buttons {
                grid-template-columns: 1fr;
            }

            .trait-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .trait-percentage {
                margin-left: 0;
                align-self: flex-end;
            }
        }

        /* ì ‘ê·¼ì„± */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <!-- ë– ë‹¤ë‹ˆëŠ” ì´ëª¨ì§€ ë°°ê²½ -->
    <div class="floating-emojis">
        <div class="floating-emoji" style="top: 10%; left: 10%; animation-delay: 0s;">ğŸŒ»</div>
        <div class="floating-emoji" style="top: 20%; right: 15%; animation-delay: 2s;">ğŸˆ</div>
        <div class="floating-emoji" style="bottom: 30%; left: 20%; animation-delay: 4s;">ğŸ€</div>
        <div class="floating-emoji" style="bottom: 20%; right: 10%; animation-delay: 6s;">ğŸŒˆ</div>
        <div class="floating-emoji" style="top: 50%; left: 5%; animation-delay: 1s;">ğŸ¯</div>
        <div class="floating-emoji" style="top: 60%; right: 8%; animation-delay: 3s;">â­</div>
    </div>

    <div class="app-container">
        <header class="app-header">
            <h1 class="app-title">ğŸ’ ë™ë£Œë“¤ì´ ë³´ëŠ” ë‚˜</h1>
            <p class="app-subtitle">
                ë™ë£Œë“¤ì˜ ë”°ëœ»í•œ ì‹œì„ ìœ¼ë¡œ ë°œê²¬í•˜ëŠ”<br>
                ë‚˜ì˜ ìˆ¨ê²¨ì§„ ë§¤ë ¥ê³¼ ë¹›ë‚˜ëŠ” ëª¨ìŠµë“¤ âœ¨
            </p>
        </header>

        <main class="app-content">
            <!-- ì„¤ë¬¸ ìƒì„± í™”ë©´ -->
            <div id="setupScreen" class="screen active">
                <div class="encouragement-card">
                    ğŸ’« <strong>ë‹¹ì‹ ì€ ì´ë¯¸ ì¶©ë¶„íˆ íŠ¹ë³„í•˜ê³  ì†Œì¤‘í•œ ì¡´ì¬ì˜ˆìš”!</strong><br>
                    ë™ë£Œë“¤ì˜ ì‹œì„ ì—ì„œ ë°œê²¬ë  ë‹¹ì‹ ì˜ ë°˜ì§ì´ëŠ” ëª¨ìŠµë“¤ì´ ì •ë§ ê¸°ëŒ€ë¼ìš” âœ¨
                </div>
                
                <form id="setupForm">
                    <div class="form-group">
                        <label for="userName" class="form-label">ğŸŒŸ ë‚´ ë‹‰ë„¤ì„ (ì‹¤ëª…ë„ ê´œì°®ì•„ìš”!)</label>
                        <input 
                            type="text" 
                            id="userName" 
                            class="form-input"
                            placeholder="ì˜ˆ: ê·€ì—¬ìš´ ê¹€ë˜ë¦¬, ê¹€ë¯¼ìˆ˜, ë°ì€ì—ë„ˆì§€ ë“±"
                            required
                        >
                    </div>
                    
                    <button type="submit" class="btn">
                        ğŸš€ ë‚´ ì „ìš© ë§í¬ ë§Œë“¤ê¸°
                    </button>
                </form>
                
                <div class="encouragement-card">
                    ğŸ’¡ <strong>ë§í¬ë¥¼ ë§Œë“¤ë©´ ë™ë£Œë“¤ì´ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ<br>
                    ë°”ë¡œ ë‹¹ì‹ ì— ëŒ€í•œ ì„¤ë¬¸ì— ì°¸ì—¬í•  ìˆ˜ ìˆì–´ìš”!</strong><br>
                    ì¹´í†¡ì´ë‚˜ ìŠ¬ë™ìœ¼ë¡œ ë§í¬ë§Œ ë³´ë‚´ë©´ ë! ğŸ¯
                </div>
            </div>

            <!-- ì„¤ë¬¸ ì°¸ì—¬ í™”ë©´ -->
            <div id="surveyScreen" class="screen">
                <div class="survey-intro">
                    <div id="targetName" class="target-name"></div>
                    <div class="survey-description">
                        <strong>ì´ ì†Œì¤‘í•œ ë¶„ì— ëŒ€í•´<br>
                        ë‹¹ì‹ ì´ ëŠë¼ëŠ” ì†”ì§í•œ ìƒê°ì„ ë“¤ë ¤ì£¼ì„¸ìš”!</strong> ğŸ’<br>
                        ë‹¹ì‹ ì˜ ë”°ëœ»í•œ ì‹œì„ ì´ ëˆ„êµ°ê°€ì—ê²ŒëŠ” í° í˜ì´ ë  ê±°ì˜ˆìš” ğŸŒˆ
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span id="progressText" class="progress-text">1/10 ì§ˆë¬¸</span>
                        <span class="progress-text">ğŸ¯</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                </div>
                
                <div class="question-card">
                    <h2 id="questionTitle" class="question-title"></h2>
                    <div id="optionsContainer" class="options-grid"></div>
                </div>

                <div id="loadingScreen" class="loading-screen">
                    <div class="loading-dots">ë‹µë³€ì„ ì €ì¥í•˜ê³  ìˆì–´ìš”... âœ¨</div>
                </div>
            </div>

            <!-- ê²°ê³¼ í™”ë©´ -->
            <div id="resultScreen" class="screen">
                <div id="resultStats" class="result-stats"></div>
                
                <div class="result-card">
                    <div class="result-header">
                        <h2 class="result-title">âœ¨ ë™ë£Œë“¤ì´ ë°œê²¬í•œ<br>ë‚˜ì˜ ë¹›ë‚˜ëŠ” ëª¨ìŠµë“¤</h2>
                        <div id="resultDescription" class="result-description"></div>
                    </div>
                    <div id="traitsList" class="trait-list"></div>
                </div>
                
                <div class="share-section">
                    <p class="share-description">
                        ğŸ¯ <strong>ë” ë§ì€ ë™ë£Œë“¤ì—ê²Œ ì‚¬ë‘ë°›ëŠ” ë‚´ ëª¨ìŠµ ë°œê²¬í•˜ê¸°</strong><br>
                        ì•„ë˜ ë§í¬ë¥¼ ê³µìœ í•´ì„œ ë” ë§ì€ ë”°ëœ»í•œ ì‹œì„ ë“¤ì„ ëª¨ì•„ë³´ì„¸ìš”! ğŸ’
                    </p>
                    <div id="shareLink" class="share-link"></div>
                    
                    <div class="share-buttons">
                        <button id="kakaoShareBtn" class="share-btn kakao">
                            ğŸ’¬ ì¹´í†¡ ê³µìœ 
                        </button>
                        <button id="copyLinkBtn" class="share-btn copy">
                            ğŸ“‹ ë§í¬ ë³µì‚¬
                        </button>
                    </div>
                    
                    <button id="newSurveyBtn" class="btn btn-secondary">
                        ğŸŒŸ ìƒˆë¡œìš´ ë§¤ë ¥ ë°œêµ´í•˜ê¸°
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ
        const AppState = {
            currentUser: null,
            currentUserName: null, // í˜„ì¬ ì‚¬ìš©ìëª… ì €ì¥
            currentQuestionIndex: 0,
            answers: [],
            surveys: {},
            isAnswering: false
        };

        // ì„¤ë¬¸ ì§ˆë¬¸ ë°ì´í„°
        const QUESTIONS = [
            {
                text: "ğŸŒ… ì•„ì¹¨ ì¶œê·¼í•  ë•Œ<br>ì´ ì‚¬ëŒì˜ ì—ë„ˆì§€ëŠ”?",
                options: [
                    { emoji: "â˜€ï¸", text: "365ì¼ ë¹„íƒ€ë¯¼D í’€ì¶©ì „ í–‡ì‚´ ì¸ê°„", trait: "energetic" },
                    { emoji: "ğŸŒ™", text: "ì€ì€í•˜ê²Œ ë¹›ë‚˜ëŠ” ë‹¬ë¹› ê°ì„±", trait: "calm" },
                    { emoji: "âš¡", text: "ë²ˆê°œì²˜ëŸ¼ ë¹ ë¥¸ ëª¨ë‹ ë£¨í‹´ ë§ˆìŠ¤í„°", trait: "efficient" },
                    { emoji: "ğŸŒ¸", text: "ì²œì²œíˆ í•˜ì§€ë§Œ í™•ì‹¤í•œ ê½ƒê¸¸ ì›Œì»¤", trait: "steady" }
                ]
            },
            {
                text: "ğŸ’¼ ì—…ë¬´ ì²˜ë¦¬ ìŠ¤íƒ€ì¼ì„<br>ë™ë¬¼ë¡œ ë¹„ìœ í•˜ë©´?",
                options: [
                    { emoji: "ğŸ†", text: "ì¹˜íƒ€ì²˜ëŸ¼ ë¹ ë¥´ê³  ì •í™•í•œ ìŠ¤í”¼ë“œëŸ¬ë„ˆ", trait: "speedy" },
                    { emoji: "ğŸ¦‰", text: "ì˜¬ë¹¼ë¯¸ì²˜ëŸ¼ ê¼¼ê¼¼í•˜ê³  í˜„ëª…í•œ ì „ëµê°€", trait: "wise" },
                    { emoji: "ğŸ", text: "ê¿€ë²Œì²˜ëŸ¼ ë¶€ì§€ëŸ°í•œ í˜‘ì—… ë§ˆìŠ¤í„°", trait: "collaborative" },
                    { emoji: "ğŸ¦„", text: "ìœ ë‹ˆì½˜ì²˜ëŸ¼ ì°½ì˜ì ì´ê³  íŠ¹ë³„í•œ ì•„ì´ë””ì–´ ë©”ì´ì»¤", trait: "creative" }
                ]
            },
            {
                text: "ğŸ—£ï¸ íšŒì˜ ì‹œê°„ì—<br>ì´ ì‚¬ëŒì˜ ì—­í• ì€?",
                options: [
                    { emoji: "ğŸ¤", text: "ë§ˆì´í¬ ì¡ìœ¼ë©´ TED í† í¬ê¸‰ ë°œí‘œì™•", trait: "presenter" },
                    { emoji: "ğŸ’¡", text: "í•œë§ˆë””ë¡œ ëª¨ë‘ë¥¼ 'ì•„í•˜!' í•˜ê²Œ ë§Œë“œëŠ” ì¸ì‚¬ì´íŠ¸ í‚¹", trait: "insightful" },
                    { emoji: "ğŸ¯", text: "í•µì‹¬ë§Œ ë”±ë”± ì§šì–´ë‚´ëŠ” ìš”ì•½ì˜ ë‹¬ì¸", trait: "concise" },
                    { emoji: "ğŸ‘‚", text: "ëª¨ë“  ì˜ê²¬ì„ ë”°ëœ»í•˜ê²Œ ë“¤ì–´ì£¼ëŠ” ë¦¬ìŠ¤ë‹ ë§ˆìŠ¤í„°", trait: "listener" }
                ]
            },
            {
                text: "â˜• ì ì‹¬ì‹œê°„ì´ë‚˜ ì‰¬ëŠ” ì‹œê°„ì˜<br>ì´ ì‚¬ëŒì€?",
                options: [
                    { emoji: "ğŸª", text: "ì–´ë””ì„œë“  ì›ƒìŒê½ƒì´ í”¼ëŠ” ì—”í„°í…Œì´ë„ˆ", trait: "entertainer" },
                    { emoji: "ğŸ“š", text: "í˜¼ìë§Œì˜ ì‹œê°„ìœ¼ë¡œ ì—ë„ˆì§€ ì¶©ì „í•˜ëŠ” íëŸ¬", trait: "introspective" },
                    { emoji: "ğŸ°", text: "ë§›ì§‘ ì •ë³´ì™€ TMIë¡œ ì¬ë¯¸ë¥¼ ì£¼ëŠ” ì •ë³´í†µ", trait: "informative" },
                    { emoji: "ğŸ¤—", text: "ëˆ„êµ¬ë“  í¸í•˜ê²Œ ì°¾ì•„ì˜¬ ìˆ˜ ìˆëŠ” ì¸ê°„ ì¹´í˜", trait: "approachable" }
                ]
            },
            {
                text: "ğŸ”¥ ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì—…ë¬´ ë³€í™”ë‚˜<br>ìœ„ê¸° ìƒí™©ì´ ìƒê¸°ë©´?",
                options: [
                    { emoji: "ğŸš€", text: "1ì´ˆ ë§Œì— í”ŒëœB êº¼ë‚´ëŠ” ì‹ ì† ëŒ€ì‘ ë§ˆìŠ¤í„°", trait: "adaptable" },
                    { emoji: "ğŸ§ ", text: "ì°¨ê·¼ì°¨ê·¼ ë¶„ì„í•´ì„œ ì™„ë²½í•œ ì†”ë£¨ì…˜ ì œì‹œ", trait: "analytical" },
                    { emoji: "ğŸ›¡ï¸", text: "íŒ€ì›ë“¤ ë‹¤ ì±™ê¸°ë©´ì„œ í•¨ê»˜ í—¤ì³ë‚˜ê°€ëŠ” ë¦¬ë”", trait: "protective" },
                    { emoji: "ğŸ§Š", text: "íƒœì‚°ì´ ë¬´ë„ˆì ¸ë„ í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ë©˜íƒˆ ê°‘", trait: "stable" }
                ]
            },
            {
                text: "ğŸŒŸ ë™ë£Œê°€ í˜ë“¤ì–´í•  ë•Œ<br>ì´ ì‚¬ëŒì˜ ëŒ€ì‘ë²•ì€?",
                options: [
                    { emoji: "ğŸ”¥", text: "ë‹¤ì‹œ ì¼ì–´ì„¤ ìš©ê¸°ë¥¼ ë¶ˆì–´ë„£ì–´ì£¼ëŠ” ì¹˜ì–´ë¦¬ë”", trait: "motivating" },
                    { emoji: "ğŸ¤—", text: "ë”°ëœ»í•œ ìœ„ë¡œì™€ ê³µê°ìœ¼ë¡œ ë§ˆìŒì„ ë‹¬ë˜ì£¼ëŠ” íëŸ¬", trait: "comforting" },
                    { emoji: "ğŸ’¡", text: "êµ¬ì²´ì ì´ê³  ì‹¤ì§ˆì ì¸ í•´ê²°ë°©ì•ˆ ì œì‹œí•˜ëŠ” ì†”ë²„", trait: "problemsolver" },
                    { emoji: "ğŸ­", text: "ì›ƒìŒê³¼ ìœ ë¨¸ë¡œ ë¶„ìœ„ê¸° ì „í™˜ì‹œí‚¤ëŠ” ë¬´ë“œë©”ì´ì»¤", trait: "humorous" }
                ]
            },
            {
                text: "ğŸ¯ ì—…ë¬´ì—ì„œ ì´ ì‚¬ëŒì˜<br>ê°€ì¥ ë‹ë³´ì´ëŠ” ê°•ì ì€?",
                options: [
                    { emoji: "âš¡", text: "ë²ˆê°œê°™ì€ ì¼ì²˜ë¦¬ ì†ë„ì™€ ì •í™•ì„±", trait: "efficient" },
                    { emoji: "ğŸ¨", text: "ë‚¨ë“¤ì´ ìƒê° ëª»í•œ ì°½ì˜ì  ì•„ì´ë””ì–´", trait: "innovative" },
                    { emoji: "ğŸ’", text: "ì–´ë–¤ ìƒí™©ì—ì„œë„ ë¯¿ê³  ë§¡ê¸¸ ìˆ˜ ìˆëŠ” ì‹ ë¢°ë„", trait: "trustworthy" },
                    { emoji: "ğŸŒˆ", text: "íŒ€ ë¶„ìœ„ê¸°ë¥¼ í™”ê¸°ì• ì• í•˜ê²Œ ë§Œë“œëŠ” ë§¤ë ¥", trait: "harmonious" }
                ]
            },
            {
                text: "ğŸ“± ë””ì§€í„¸ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ì—ì„œ<br>ì´ ì‚¬ëŒì˜ íŠ¹ì§•ì€?",
                options: [
                    { emoji: "âš¡", text: "ë©”ì‹œì§€ ì˜¤ë©´ 3ì´ˆ ì•ˆì— ë‹µì¥í•˜ëŠ” ë¹›ì˜ ì†ë„", trait: "responsive" },
                    { emoji: "ğŸ“", text: "í•­ìƒ ì •ì¤‘í•˜ê³  ì •í™•í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë§¤ë„ˆ", trait: "professional" },
                    { emoji: "ğŸ˜„", text: "ì´ëª¨ì§€ì™€ ìœ ë¨¸ë¡œ ëŒ€í™”ë¥¼ ì¦ê²ê²Œ ë§Œë“œëŠ” ì¬ë¯¸ê¾¼", trait: "playful" },
                    { emoji: "ğŸ¯", text: "í•µì‹¬ë§Œ ê°„ë‹¨ëª…ë£Œí•˜ê²Œ ì „ë‹¬í•˜ëŠ” íš¨ìœ¨ì„±", trait: "concise" }
                ]
            },
            {
                text: "ğŸ† í”„ë¡œì íŠ¸ ë§ˆê° ì „ë‚ ,<br>ì´ ì‚¬ëŒì˜ ëª¨ìŠµì€?",
                options: [
                    { emoji: "ğŸ”¥", text: "ë§ˆì§€ë§‰ê¹Œì§€ ì—´ì •ì ìœ¼ë¡œ ì™„ë²½ì„ ì¶”êµ¬í•˜ëŠ” ì—´í˜ˆíŒŒ", trait: "passionate" },
                    { emoji: "ğŸ˜Œ", text: "ì—¬ìœ ë¡­ê²Œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì ê²€í•˜ëŠ” ê³„íšíŒŒ", trait: "organized" },
                    { emoji: "ğŸ¤", text: "íŒ€ì›ë“¤ ë„ì™€ì£¼ëŠë¼ ë°”ìœ ë“ ë“ í•œ ì§€ì›êµ°", trait: "supportive" },
                    { emoji: "ğŸ§˜", text: "ì¹¨ì°©í•˜ê²Œ ë§ˆë¬´ë¦¬í•˜ëŠ” ë©˜íƒˆ ê´€ë¦¬ ë§ˆìŠ¤í„°", trait: "composed" }
                ]
            },
            {
                text: "ğŸ’ ë™ë£Œë¡œì„œ ì´ ì‚¬ëŒì„<br>í•œ ë¬¸ì¥ìœ¼ë¡œ í‘œí˜„í•œë‹¤ë©´?",
                options: [
                    { emoji: "ğŸ†", text: "ê°™ì€ íŒ€ì´ì–´ì„œ ë“ ë“ í•˜ê³  ìë‘ìŠ¤ëŸ¬ìš´ ì—ì´ìŠ¤", trait: "reliable" },
                    { emoji: "ğŸŒŸ", text: "ìˆëŠ” ê²ƒë§Œìœ¼ë¡œë„ íŒ€ì´ ë¹›ë‚˜ê²Œ ë§Œë“œëŠ” ë³´ì„", trait: "inspiring" },
                    { emoji: "ğŸª", text: "ì¼ìƒì„ ì¦ê²ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” í–‰ë³µ ë°”ì´ëŸ¬ìŠ¤", trait: "joyful" },
                    { emoji: "ğŸ’", text: "ë§Œë‚˜ì„œ ì •ë§ ë‹¤í–‰ì¸ ì¸ìƒ ì„ ë°°ë‹˜", trait: "precious" }
                ]
            }
        ];

        // íŠ¹ì„± ì„¤ëª… ë°ì´í„°
        const TRAIT_DESCRIPTIONS = {
            energetic: { name: "ì—ë„ˆì§€ ì¶©ì „ê¸°", desc: "ë‹¹ì‹ ì˜ í™œê¸°ì°¬ ëª¨ìŠµì´ ëª¨ë‘ì—ê²Œ í˜ì„ ì¤˜ìš”" },
            calm: { name: "í‰ì˜¨í•œ ë§ˆìŒ", desc: "ì°¨ë¶„í•˜ê³  ì•ˆì •ê° ìˆëŠ” ë‹¹ì‹ ì˜ ì¡´ì¬ê°€ ì†Œì¤‘í•´ìš”" },
            efficient: { name: "íš¨ìœ¨ì„± ë§ˆìŠ¤í„°", desc: "ë¹ ë¥´ê³  ì •í™•í•œ ë‹¹ì‹ ì˜ ëŠ¥ë ¥ì— ëª¨ë‘ê°€ ê°íƒ„í•´ìš”" },
            steady: { name: "ê¾¸ì¤€í•œ ë…¸ë ¥ê°€", desc: "ë¬µë¬µíˆ ìµœì„ ì„ ë‹¤í•˜ëŠ” ë‹¹ì‹ ì˜ ëª¨ìŠµì´ ì•„ë¦„ë‹¤ì›Œìš”" },
            speedy: { name: "ìŠ¤í”¼ë“œ í‚¹", desc: "ë¹›ì˜ ì†ë„ë¡œ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ë‹¹ì‹ ì´ ë†€ë¼ì›Œìš”" },
            wise: { name: "ì§€í˜œë¡œìš´ ì¡°ì–¸ì", desc: "ê¹Šì´ ìˆëŠ” ìƒê°ìœ¼ë¡œ ëª¨ë‘ë¥¼ ì´ë„ëŠ” ë©˜í† " },
            collaborative: { name: "í˜‘ì—…ì˜ ë‹¬ì¸", desc: "í•¨ê»˜ ì¼í•  ë•Œ ì§„ê°€ë¥¼ ë°œíœ˜í•˜ëŠ” íŒ€í”Œë ˆì´ì–´" },
            creative: { name: "ì°½ì˜ë ¥ í­ë°œ", desc: "ì°¸ì‹ í•œ ì•„ì´ë””ì–´ë¡œ ëª¨ë‘ë¥¼ ë†€ë¼ê²Œ í•˜ëŠ” í¬ë¦¬ì—ì´í„°" },
            presenter: { name: "ë°œí‘œ ì²œì¬", desc: "ë‹¹ì‹ ì˜ í”„ë ˆì  í…Œì´ì…˜ì€ ì–¸ì œë‚˜ ì¸ìƒ ê¹Šì–´ìš”" },
            insightful: { name: "ì¸ì‚¬ì´íŠ¸ í‚¹", desc: "í•µì‹¬ì„ ì°Œë¥´ëŠ” í†µì°°ë ¥ì˜ ì†Œìœ ì" },
            concise: { name: "ìš”ì•½ì˜ ë‹¬ì¸", desc: "ë³µì¡í•œ ë‚´ìš©ì„ ëª…í™•í•˜ê²Œ ì •ë¦¬í•˜ëŠ” ëŠ¥ë ¥ì" },
            listener: { name: "ê²½ì²­ ë§ˆìŠ¤í„°", desc: "ëª¨ë“  ì´ì•¼ê¸°ë¥¼ ë”°ëœ»í•˜ê²Œ ë“¤ì–´ì£¼ëŠ” ì‚¬ëŒ" },
            entertainer: { name: "ë¶„ìœ„ê¸° ë©”ì´ì»¤", desc: "ë‹¹ì‹  ë•ë¶„ì— íšŒì‚¬ê°€ ì¦ê±°ì›Œì ¸ìš”" },
            introspective: { name: "ì‚¬ìƒ‰í•˜ëŠ” ì² í•™ì", desc: "ê¹Šì´ ìˆëŠ” ì‚¬ê³ ë¥¼ í•˜ëŠ” ì§€ì ì¸ ë§¤ë ¥" },
            informative: { name: "ì •ë³´ ê³µìœ  ë§ˆìŠ¤í„°", desc: "ìœ ìš©í•œ ì •ë³´ë¡œ ëª¨ë‘ë¥¼ ë„ì™€ì£¼ëŠ” ì¹œì ˆí•œ ì‚¬ëŒ" },
            approachable: { name: "ì¸ê°„ ì¹´í˜", desc: "ëˆ„êµ¬ë‚˜ í¸í•˜ê²Œ ë‹¤ê°€ê°ˆ ìˆ˜ ìˆëŠ” ë”°ëœ»í•¨" },
            adaptable: { name: "ì ì‘ë ¥ ê°‘", desc: "ì–´ë–¤ ìƒí™©ì—ë„ ìœ ì—°í•˜ê²Œ ëŒ€ì²˜í•˜ëŠ” ëŠ¥ë ¥ì" },
            analytical: { name: "ë¶„ì„ì˜ ë‹¬ì¸", desc: "ì²´ê³„ì ì¸ ì‚¬ê³ ë¡œ ì™„ë²½í•œ í•´ë‹µì„ ì°¾ì•„ë‚´ìš”" },
            protective: { name: "ë“ ë“ í•œ ë³´í˜¸ì", desc: "íŒ€ì›ë“¤ì„ ì±™ê¸°ëŠ” ë”°ëœ»í•œ ë¦¬ë”ì‹­" },
            stable: { name: "ë©˜íƒˆ ê°‘", desc: "í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ì•ˆì •ê°ìœ¼ë¡œ ëª¨ë‘ì˜ ë²„íŒ€ëª©" },
            motivating: { name: "ë™ê¸°ë¶€ì—¬ ë§ˆìŠ¤í„°", desc: "ë‹¹ì‹ ì˜ ì‘ì›ì´ í° í˜ì´ ë˜ì–´ìš”" },
            comforting: { name: "íë§ ìš”ì •", desc: "ë”°ëœ»í•œ ìœ„ë¡œë¡œ ë§ˆìŒì„ ì¹˜ìœ í•´ì£¼ëŠ” ì‚¬ëŒ" },
            problemsolver: { name: "ë¬¸ì œí•´ê²° ì²œì¬", desc: "ì–´ë ¤ìš´ ìƒí™©ë„ ì²™ì²™ í•´ê²°í•˜ëŠ” ëŠ¥ë ¥ì" },
            humorous: { name: "ì›ƒìŒ ì œì¡°ê¸°", desc: "ìœ ë¨¸ë¡œ ëª¨ë“  ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë‚ ë ¤ë²„ë ¤ìš”" },
            innovative: { name: "í˜ì‹ ì  ì‚¬ê³ ", desc: "ìƒˆë¡œìš´ ê´€ì ìœ¼ë¡œ ëª¨ë‘ë¥¼ ë†€ë¼ê²Œ í•´ìš”" },
            trustworthy: { name: "ì‹ ë¢°ë„ MAX", desc: "ë‹¹ì‹ ë§Œí¼ ë¯¿ì„ ë§Œí•œ ì‚¬ëŒì„ ì°¾ê¸° ì–´ë ¤ì›Œìš”" },
            harmonious: { name: "í™”í•©ì˜ ì¤‘ì‹¬", desc: "íŒ€ ë¶„ìœ„ê¸°ë¥¼ í™”ê¸°ì• ì• í•˜ê²Œ ë§Œë“œëŠ” ë§ˆë²•ì‚¬" },
            responsive: { name: "ì†Œí†µ ë§ˆìŠ¤í„°", desc: "ë¹ ë¥¸ ì‘ë‹µìœ¼ë¡œ ì›í™œí•œ ì†Œí†µì„ ì´ë„ëŠ” í”„ë¡œ" },
            professional: { name: "ë¹„ì¦ˆë‹ˆìŠ¤ ë§¤ë„ˆ", desc: "í•­ìƒ ì •ì¤‘í•˜ê³  ì„¸ë ¨ëœ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜" },
            playful: { name: "ì¬ë¯¸ìˆëŠ” ëŒ€í™”", desc: "ìœ ë¨¸ì™€ ì¬ì¹˜ë¡œ ëŒ€í™”ë¥¼ ì¦ê²ê²Œ ë§Œë“œëŠ” ì‚¬ëŒ" },
            passionate: { name: "ì—´ì • ë°”ì´ëŸ¬ìŠ¤", desc: "ë‹¹ì‹ ì˜ ì—´ì •ì´ ëª¨ë‘ì—ê²Œ ì „ì—¼ë˜ì–´ìš”" },
            organized: { name: "ì²´ê³„ì  ê³„íš", desc: "ì™„ë²½í•œ ê³„íšê³¼ ì¤€ë¹„ë¡œ ëª¨ë‘ë¥¼ ì•ˆì‹¬ì‹œì¼œìš”" },
            supportive: { name: "ë“ ë“ í•œ ì§€ì›êµ°", desc: "ì–¸ì œë‚˜ íŒ€ì›ë“¤ì„ ë„ì™€ì£¼ëŠ” ë”°ëœ»í•œ ë§ˆìŒ" },
            composed: { name: "ì¹¨ì°©í•œ ë¦¬ë”", desc: "ì–´ë–¤ ìƒí™©ì—ì„œë„ ì°¨ë¶„í•¨ì„ ìœ ì§€í•˜ëŠ” ë©˜íƒˆ" },
            reliable: { name: "ë¯¿ìŒì§í•œ ë™ë°˜ì", desc: "ê°™ì€ íŒ€ì´ë¼ì„œ ì •ë§ ë‹¤í–‰ì¸ ë“ ë“ í•œ ì¡´ì¬" },
            inspiring: { name: "ì˜ê°ì„ ì£¼ëŠ” ì‚¬ëŒ", desc: "ë‹¹ì‹ ì„ ë³´ë©´ ì €ì ˆë¡œ ë™ê¸°ë¶€ì—¬ê°€ ë˜ì–´ìš”" },
            joyful: { name: "í–‰ë³µ ë°”ì´ëŸ¬ìŠ¤", desc: "ë‹¹ì‹ ì˜ ë°ì€ ì—ë„ˆì§€ê°€ ëª¨ë‘ë¥¼ ì›ƒê²Œ ë§Œë“¤ì–´ìš”" },
            precious: { name: "ì†Œì¤‘í•œ ë³´ë¬¼", desc: "ë§Œë‚˜ì„œ ì •ë§ ë‹¤í–‰ì¸ íŠ¹ë³„í•œ ì‚¬ëŒ" }
        };

        // ê²©ë ¤ ë©”ì‹œì§€
        const ENCOURAGEMENT_MESSAGES = [
            "ğŸŒ» ë™ë£Œë“¤ì´ ë‹¹ì‹ ì„ ì´ë ‡ê²Œ ìƒê°í•˜ê³  ìˆì—ˆë‹¤ë‹ˆ!<br>ì •ë§ ì‚¬ë‘ìŠ¤ëŸ½ê³  íŠ¹ë³„í•œ ì¡´ì¬ì‹œë„¤ìš” âœ¨",
            "ğŸˆ ì´ ê²°ê³¼ë¥¼ ë³´ë‹ˆ ë‹¹ì‹ ì´ ì–¼ë§ˆë‚˜ ì†Œì¤‘í•œ ì‚¬ëŒì¸ì§€<br>ë‹¤ì‹œ í•œë²ˆ ëŠë¼ê²Œ ë˜ì–´ìš” ğŸŒŸ",
            "ğŸŒˆ ë™ë£Œë“¤ì˜ ë”°ëœ»í•œ ì‹œì„ ì—ì„œ ë°œê²¬ëœ<br>ë‹¹ì‹ ì˜ ë¹›ë‚˜ëŠ” ëª¨ìŠµë“¤ì´ ì •ë§ ì•„ë¦„ë‹¤ì›Œìš” ğŸ’",
            "ğŸ¯ ì´ëŸ° í‰ê°€ë¥¼ ë°›ëŠ”ë‹¤ëŠ” ê±´<br>ë‹¹ì‹ ì´ ì–¼ë§ˆë‚˜ ë©‹ì§„ ì‚¬ëŒì¸ì§€ ë³´ì—¬ì£¼ëŠ” ê±°ì˜ˆìš”! ğŸ†"
        ];

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        const Utils = {
            generateSurveyId: (userName) => {
                return btoa(encodeURIComponent(userName)).replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
            },

            getUserFromUrl: () => {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('user');
            },

            showScreen: (screenId) => {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
            },

            copyToClipboard: async (text) => {
                try {
                    // í˜„ëŒ€ì ì¸ Clipboard API ì‹œë„
                    if (navigator.clipboard && window.isSecureContext) {
                        await navigator.clipboard.writeText(text);
                        return true;
                    } else {
                        // Fallback ë°©ë²•
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        textArea.style.position = 'fixed';
                        textArea.style.left = '-999999px';
                        textArea.style.top = '-999999px';
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();
                        const result = document.execCommand('copy');
                        document.body.removeChild(textArea);
                        return result;
                    }
                } catch (err) {
                    return false;
                }
            },

            showNotification: (message) => {
                alert(message);
            }
        };

        // í™”ë©´ ê´€ë¦¬ì
        const ScreenManager = {
            showSetup: () => {
                Utils.showScreen('setupScreen');
            },

            showSurvey: (userName) => {
                document.getElementById('targetName').innerHTML = `ğŸ’ ${decodeURIComponent(userName)} ë‹˜`;
                
                // ì„¤ë¬¸ ë°ì´í„° ë¯¸ë¦¬ ìƒì„±
                const surveyId = Utils.generateSurveyId(userName);
                if (!AppState.surveys[surveyId]) {
                    AppState.surveys[surveyId] = {
                        name: userName,
                        responses: [],
                        traits: {},
                        createdAt: new Date().toISOString()
                    };
                }
                AppState.currentUser = surveyId;
                
                Utils.showScreen('surveyScreen');
                SurveyManager.startSurvey();
            },

            showResults: (surveyId, userName) => {
                Utils.showScreen('resultScreen');
                ResultManager.displayResults(surveyId, userName);
            }
        };

        // ì„¤ë¬¸ ê´€ë¦¬ì
        const SurveyManager = {
            startSurvey() {
                AppState.currentQuestionIndex = 0;
                AppState.answers = [];
                AppState.isAnswering = false;
                this.showCurrentQuestion();
            },

            showCurrentQuestion() {
                const question = QUESTIONS[AppState.currentQuestionIndex];
                const questionTitle = document.getElementById('questionTitle');
                const optionsContainer = document.getElementById('optionsContainer');
                
                questionTitle.innerHTML = question.text;
                optionsContainer.innerHTML = '';

                question.options.forEach((option, index) => {
                    const optionCard = document.createElement('div');
                    optionCard.className = 'option-card';
                    optionCard.innerHTML = `
                        <div class="option-content">
                            <span class="option-emoji">${option.emoji}</span>
                            <span class="option-text">${option.text}</span>
                        </div>
                    `;
                    optionCard.addEventListener('click', () => this.selectOption(index, optionCard));
                    optionsContainer.appendChild(optionCard);
                });

                this.updateProgress();
            },

            selectOption(index, element) {
                if (AppState.isAnswering) return;
                
                AppState.isAnswering = true;
                
                // ì‹œê°ì  í”¼ë“œë°±
                document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
                });
                element.classList.add('selected');

                // ë‹µë³€ ì €ì¥
                const question = QUESTIONS[AppState.currentQuestionIndex];
                AppState.answers[AppState.currentQuestionIndex] = question.options[index].trait;

                // ë¡œë”© í™”ë©´ í‘œì‹œ
                document.getElementById('loadingScreen').style.display = 'block';

                // ë‹¤ìŒ ì§ˆë¬¸ìœ¼ë¡œ ì§„í–‰
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    this.nextQuestion();
                    AppState.isAnswering = false;
                }, 1000);
            },

            nextQuestion() {
                AppState.currentQuestionIndex++;
                
                if (AppState.currentQuestionIndex < QUESTIONS.length) {
                    this.showCurrentQuestion();
                } else {
                    this.submitSurvey();
                }
            },

            updateProgress() {
                const progress = ((AppState.currentQuestionIndex + 1) / QUESTIONS.length) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('progressText').textContent = `${AppState.currentQuestionIndex + 1}/${QUESTIONS.length} ì§ˆë¬¸`;
            },

            submitSurvey() {
                const surveyId = AppState.currentUser;
                
                // ì„¤ë¬¸ì´ ì—†ìœ¼ë©´ ìƒì„±
                if (!AppState.surveys[surveyId]) {
                    AppState.surveys[surveyId] = {
                        name: Utils.getUserFromUrl(),
                        responses: [],
                        traits: {},
                        createdAt: new Date().toISOString()
                    };
                }

                // ì‘ë‹µ ì €ì¥
                AppState.surveys[surveyId].responses.push({
                    answers: AppState.answers,
                    timestamp: new Date().toISOString()
                });

                // íŠ¹ì„±ë³„ ì§‘ê³„
                AppState.answers.forEach(trait => {
                    if (!AppState.surveys[surveyId].traits[trait]) {
                        AppState.surveys[surveyId].traits[trait] = 0;
                    }
                    AppState.surveys[surveyId].traits[trait]++;
                });

                // ì™„ë£Œ ë©”ì‹œì§€
                Utils.showNotification(
                    'ğŸˆ ì†Œì¤‘í•œ ì‘ì› ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!\n\n' +
                    'ë‹¹ì‹ ì˜ ë”°ëœ»í•œ ë§ˆìŒì´ ëˆ„êµ°ê°€ì—ê²Œ í° í˜ì´ ë  ê±°ì˜ˆìš” ğŸ’\n\n' +
                    'ë‹¹ì‹ ë„ ë™ë£Œë“¤ì—ê²Œ ë‚˜ì˜ ëª¨ìŠµì„ ë¬¼ì–´ë³´ê³  ì‹¶ë‹¤ë©´\n' +
                    'ìƒˆ ì°½ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”! ğŸŒ»'
                );

                // ìƒˆ ì°½ì—ì„œ í…ŒìŠ¤íŠ¸ ì—´ê¸°
                setTimeout(() => {
                    window.open(window.location.origin + window.location.pathname, '_blank');
                    window.close();
                }, 3000);
            }
        };

        // ê²°ê³¼ ê´€ë¦¬ì
        const ResultManager = {
            displayResults: (surveyId, userName) => {
                const survey = AppState.surveys[surveyId] || {
                    name: userName,
                    responses: [],
                    traits: {}
                };
                
                const totalResponses = survey.responses.length;

                // í†µê³„ í‘œì‹œ
                this.displayStats(totalResponses, userName);
                
                // ê²°ê³¼ ì„¤ëª…
                this.displayDescription(totalResponses);
                
                // íŠ¹ì„± ê²°ê³¼
                this.displayTraits(survey.traits, totalResponses);
                
                // ê³µìœ  ë§í¬ ì¦‰ì‹œ ì„¤ì • + ì¬ì‹œë„ ë¡œì§
                this.setupSharing(userName);
                
                // DOM ì•ˆì •í™”ë¥¼ ìœ„í•œ ì¶”ê°€ ì‹œë„
                setTimeout(() => {
                    this.setupSharing(userName);
                }, 100);
                
                setTimeout(() => {
                    this.setupSharing(userName);
                }, 300);
            },

            displayStats: (totalResponses, userName) => {
                const statsContainer = document.getElementById('resultStats');
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${totalResponses}</div>
                        <div class="stat-label">ì‘ì› ë©”ì‹œì§€</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">ğŸ’•</div>
                        <div class="stat-label">${userName}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">âœ¨</div>
                        <div class="stat-label">ë§¤ë ¥ ë°œê²¬</div>
                    </div>
                `;
            },

            displayDescription: (totalResponses) => {
                const resultDescription = document.getElementById('resultDescription');
                
                if (totalResponses === 0) {
                    resultDescription.innerHTML = `
                        <p><strong>ì•„ì§ ë™ë£Œë“¤ì˜ ë”°ëœ»í•œ ì‹œì„ ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”!</strong></p>
                        <p>ë§í¬ë¥¼ ê³µìœ í•´ì„œ ë™ë£Œë“¤ì´ ë‹¹ì‹ ì— ëŒ€í•´ ì–´ë–»ê²Œ ìƒê°í•˜ëŠ”ì§€ ì•Œì•„ë³´ì„¸ìš” ğŸš€</p>
                        <p>ë¶„ëª… ì˜ˆìƒë³´ë‹¤ í›¨ì”¬ ì‚¬ë‘ë°›ê³  ìˆëŠ” ìì‹ ì„ ë°œê²¬í•˜ê²Œ ë  ê±°ì˜ˆìš”! âœ¨</p>
                    `;
                } else {
                    const randomMessage = ENCOURAGEMENT_MESSAGES[Math.floor(Math.random() * ENCOURAGEMENT_MESSAGES.length)];
                    resultDescription.innerHTML = `<p>${randomMessage}</p>`;
                }
            },

            displayTraits: (traits, totalResponses) => {
                const traitsContainer = document.getElementById('traitsList');
                
                if (totalResponses === 0) {
                    traitsContainer.innerHTML = '';
                    return;
                }

                const sortedTraits = Object.entries(traits)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                traitsContainer.innerHTML = sortedTraits.map(([trait, count]) => {
                    const percentage = Math.round((count / totalResponses) * 100);
                    const traitInfo = TRAIT_DESCRIPTIONS[trait];
                    
                    return `
                        <div class="trait-item">
                            <div class="trait-info">
                                <div class="trait-name">ğŸ’ ${traitInfo.name}</div>
                                <div class="trait-desc">${traitInfo.desc}</div>
                            </div>
                            <div class="trait-percentage">${percentage}%</div>
                        </div>
                    `;
                }).join('');
            },

            setupSharing: (userName) => {
                // URL ìƒì„± (í˜„ì¬ í˜ì´ì§€ + ì‚¬ìš©ì íŒŒë¼ë¯¸í„°)
                const currentUrl = window.location.origin + window.location.pathname;
                const shareUrl = `${currentUrl}?user=${encodeURIComponent(userName)}`;
                
                // ë§í¬ ìš”ì†Œ ì°¾ê¸° ë° ì„¤ì •
                const shareLinkElement = document.getElementById('shareLink');
                if (shareLinkElement) {
                    shareLinkElement.textContent = shareUrl;
                    // ë§í¬ê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
                    console.log('ê³µìœ  ë§í¬ ì„¤ì • ì™„ë£Œ:', shareUrl);
                } else {
                    console.error('shareLink ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ë‹¤ì‹œ ì‹œë„
                    setTimeout(() => {
                        const retryElement = document.getElementById('shareLink');
                        if (retryElement) {
                            retryElement.textContent = shareUrl;
                        }
                    }, 200);
                }
            }
        };

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        const setupEventListeners = () => {
            // ì„¤ë¬¸ ìƒì„± í¼
            document.getElementById('setupForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const userName = document.getElementById('userName').value.trim();
                
                if (!userName) {
                    Utils.showNotification('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ˜Š');
                    return;
                }
                
                console.log('ì„¤ë¬¸ ìƒì„± - ì‚¬ìš©ìëª…:', userName); // ë””ë²„ê¹…
                
                const surveyId = Utils.generateSurveyId(userName);
                AppState.surveys[surveyId] = {
                    name: userName,
                    responses: [],
                    traits: {},
                    createdAt: new Date().toISOString()
                };
                
                // ì‚¬ìš©ìëª…ì„ ì „ì—­ì— ì €ì¥ (ë§í¬ ìƒì„±ìš©)
                AppState.currentUserName = userName;
                
                // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ê²°ê³¼ í™”ë©´ í‘œì‹œ (DOM ì•ˆì •í™”)
                setTimeout(() => {
                    ScreenManager.showResults(surveyId, userName);
                }, 100);
            });

            // ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
            document.getElementById('kakaoShareBtn').addEventListener('click', async () => {
                const userNameElement = document.querySelector('#resultStats .stat-label');
                const userName = userNameElement ? userNameElement.textContent : (AppState.currentUserName || 'ìµëª…');
                
                let linkElement = document.getElementById('shareLink');
                let link = linkElement ? linkElement.textContent : '';
                
                // ë§í¬ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì§ì ‘ ìƒì„±
                if (!link && AppState.currentUserName) {
                    const currentUrl = window.location.origin + window.location.pathname;
                    link = `${currentUrl}?user=${encodeURIComponent(AppState.currentUserName)}`;
                    
                    // ë§í¬ ìš”ì†Œì—ë„ ì—…ë°ì´íŠ¸
                    if (linkElement) {
                        linkElement.textContent = link;
                    }
                }
                
                if (!link) {
                    Utils.showNotification('âš ï¸ ë§í¬ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!');
                    return;
                }
                
                const shareText = `ğŸŒ» ë™ë£Œë“¤ì´ ë³´ëŠ” ë‚˜ì˜ ì§„ì§œ ëª¨ìŠµ í…ŒìŠ¤íŠ¸

${userName}ë‹˜ì´ ë™ë£Œë“¤ì˜ ì‹œì„ ì—ì„œ ë°œê²¬í•˜ê³  ì‹¶ì–´í•´ìš”!

í´ë¦­ í•œ ë²ˆìœ¼ë¡œ ë°”ë¡œ ì°¸ì—¬ ê°€ëŠ¥ ğŸˆ
ë”°ëœ»í•œ ì‹œì„ ìœ¼ë¡œ ì‘ì›í•´ì£¼ì„¸ìš”~

${link}

#ë™ë£Œí…ŒìŠ¤íŠ¸ #íšŒì‚¬ìƒí™œ #ì§ì¥ì¸ #íŒ€ì›Œí¬`;

                if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                    if (navigator.share) {
                        navigator.share({
                            title: 'ë™ë£Œë“¤ì´ ë³´ëŠ” ë‚˜ì˜ ì§„ì§œ ëª¨ìŠµ',
                            text: shareText
                        });
                    } else {
                        const success = await Utils.copyToClipboard(shareText);
                        if (success) {
                            Utils.showNotification('ğŸˆ ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆì–´ìš”!\n\nì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•´ì„œ ì¹œêµ¬ë“¤ì—ê²Œ ë³´ë‚´ì£¼ì„¸ìš”! ğŸŒ»');
                        } else {
                            Utils.showNotification('ğŸˆ ê³µìœ í•˜ê¸°ë¥¼ ìœ„í•´ ë§í¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!\n\nCtrl+Cë¡œ ë³µì‚¬í•´ì„œ ì¹´í†¡ì— ë³´ë‚´ì£¼ì„¸ìš”! ğŸŒ»');
                        }
                    }
                } else {
                    const success = await Utils.copyToClipboard(shareText);
                    if (success) {
                        Utils.showNotification('ğŸˆ ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆì–´ìš”!\n\nì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•´ì„œ ì¹œêµ¬ë“¤ì—ê²Œ ë³´ë‚´ì£¼ì„¸ìš”! ğŸŒ»');
                    } else {
                        Utils.showNotification('ğŸˆ ê³µìœ í•˜ê¸°ë¥¼ ìœ„í•´ ë§í¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!\n\nCtrl+Cë¡œ ë³µì‚¬í•´ì„œ ì¹´í†¡ì— ë³´ë‚´ì£¼ì„¸ìš”! ğŸŒ»');
                    }
                }
            });

            // ë§í¬ ë³µì‚¬
            document.getElementById('copyLinkBtn').addEventListener('click', async () => {
                let linkElement = document.getElementById('shareLink');
                let link = linkElement ? linkElement.textContent : '';
                
                // ë§í¬ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì§ì ‘ ìƒì„±
                if (!link && AppState.currentUserName) {
                    const currentUrl = window.location.origin + window.location.pathname;
                    link = `${currentUrl}?user=${encodeURIComponent(AppState.currentUserName)}`;
                    
                    // ë§í¬ ìš”ì†Œì—ë„ ì—…ë°ì´íŠ¸
                    if (linkElement) {
                        linkElement.textContent = link;
                    }
                    console.log('ë§í¬ ê°•ì œ ìƒì„±:', link);
                }
                
                if (!link) {
                    Utils.showNotification('âš ï¸ ë§í¬ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!');
                    return;
                }
                
                console.log('ë³µì‚¬í•  ë§í¬:', link);
                const success = await Utils.copyToClipboard(link);
                
                if (success) {
                    Utils.showNotification(
                        'ğŸ¯ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' +
                        'ğŸŒ» ì¹´í†¡, ìŠ¬ë™, ì´ë©”ì¼ ì–´ë””ë“  ë³´ë‚´ì£¼ì„¸ìš”!\n' +
                        'ë™ë£Œë“¤ì´ í´ë¦­ í•œ ë²ˆìœ¼ë¡œ ë°”ë¡œ ì°¸ì—¬í•  ìˆ˜ ìˆì–´ìš” ğŸ’\n\n' +
                        'ë¶„ëª… ë”°ëœ»í•œ ì‘ì›ì„ ë§ì´ ë°›ìœ¼ì‹¤ ê±°ì˜ˆìš”! ğŸŒˆ'
                    );
                } else {
                    // ë³µì‚¬ ì‹¤íŒ¨ ì‹œ ë§í¬ë¥¼ ì„ íƒ ìƒíƒœë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©ìê°€ ì§ì ‘ ë³µì‚¬í•  ìˆ˜ ìˆê²Œ í•¨
                    if (linkElement) {
                        const range = document.createRange();
                        range.selectNode(linkElement);
                        window.getSelection().removeAllRanges();
                        window.getSelection().addRange(range);
                    }
                    
                    Utils.showNotification(
                        'ğŸ“‹ ë§í¬ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' +
                        'Ctrl+C (ë˜ëŠ” Cmd+C)ë¥¼ ëˆŒëŸ¬ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš” ğŸ™‚\n' +
                        'ê·¸ë¦¬ê³  ë™ë£Œë“¤ì—ê²Œ ê³µìœ í•´ë³´ì„¸ìš”! ğŸ’'
                    );
                }
            });

            // ìƒˆ ì„¤ë¬¸ ë§Œë“¤ê¸°
            document.getElementById('newSurveyBtn').addEventListener('click', () => {
                if (confirm('ìƒˆë¡œìš´ ì„¤ë¬¸ì„ ë§Œë“œì‹œê² ì–´ìš”? ğŸ†•')) {
                    window.history.replaceState({}, document.title, window.location.pathname);
                    location.reload();
                }
            });

            // ë§í¬ ì˜ì—­ í´ë¦­ìœ¼ë¡œë„ ë³µì‚¬ ê°€ëŠ¥
            document.addEventListener('click', async (e) => {
                if (e.target.id === 'shareLink') {
                    let link = e.target.textContent;
                    
                    // ë§í¬ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì§ì ‘ ìƒì„±
                    if (!link && AppState.currentUserName) {
                        const currentUrl = window.location.origin + window.location.pathname;
                        link = `${currentUrl}?user=${encodeURIComponent(AppState.currentUserName)}`;
                        e.target.textContent = link;
                    }
                    
                    if (!link) {
                        Utils.showNotification('âš ï¸ ë§í¬ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                        return;
                    }
                    
                    const success = await Utils.copyToClipboard(link);
                    
                    if (success) {
                        Utils.showNotification('ğŸ“‹ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¯');
                    } else {
                        // ì´ë¯¸ ì„ íƒë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ë§Œ
                        Utils.showNotification('ğŸ“‹ Ctrl+Cë¥¼ ëˆŒëŸ¬ì„œ ë³µì‚¬í•´ì£¼ì„¸ìš”! ğŸ™‚');
                    }
                }
            });

            // í˜ì´ì§€ ì´íƒˆ ë°©ì§€
            window.addEventListener('beforeunload', (e) => {
                if (AppState.currentUser && AppState.currentQuestionIndex > 0 && AppState.currentQuestionIndex < QUESTIONS.length) {
                    e.preventDefault();
                    e.returnValue = 'ì„¤ë¬¸ì´ ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ì–´ìš”?';
                }
            });
        };

        // ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™”
        const initializeApp = () => {
            const userName = Utils.getUserFromUrl();
            
            if (userName) {
                // ì„¤ë¬¸ ì°¸ì—¬ ëª¨ë“œ
                ScreenManager.showSurvey(userName);
            } else {
                // ì„¤ë¬¸ ìƒì„± ëª¨ë“œ
                ScreenManager.showSetup();
            }
        };

        // DOM ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            initializeApp();
        });
    </script>
</body>
</html>
